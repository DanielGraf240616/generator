#include "AD9833.h"

// Assume SPI handle hspi1 is defined elsewhere
extern SPI_HandleTypeDef hspi1;

void AD9833_Init(void) {
    // Initialize the AD9833 according to your hardware setup
    // This might involve setting up the SPI interface, setting control pins, etc.
}

void AD9833_SetFrequency(uint32_t frequency) {
    // Convert the frequency to a 28-bit word
    uint32_t freq_word = (uint32_t)((double)frequency / (double)0.1490116119384765625);

    // Write the lower 14 bits of the frequency word
    uint16_t lower14 = (freq_word & 0x3FFF) | AD9833_REG_CMD_FREQ0;
    HAL_SPI_Transmit(&hspi1, (uint8_t *)&lower14, 1, HAL_MAX_DELAY);

    // Write the upper 14 bits of the frequency word
    uint16_t upper14 = ((freq_word >> 14) & 0x3FFF) | AD9833_REG_CMD_FREQ0;
    HAL_SPI_Transmit(&hspi1, (uint8_t *)&upper14, 1, HAL_MAX_DELAY);
}

void AD9833_SetWaveform(uint16_t waveform) {
    // Write the waveform register
    HAL_SPI_Transmit(&hspi1, (uint8_t *)&waveform, 1, HAL_MAX_DELAY);
}
